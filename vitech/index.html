<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base target="_top">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css">
    <style>
        input:focus { background: pink; color: blue; }
        button:focus { background: pink; color: blue; }
        .button {
            display: inline-block;
            padding: 15px 30px;
            font-size: 30px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            outline: none;
            color: #fff;
            background-color: purple;
            border: none;
            border-radius: 15px;
            box-shadow: 0 9px #999;
        }

        .button:hover { background-color: #58257b }
        .button:active {
            background-color: #58257b;
            box-shadow: 0 5px #666;
            transform: translateY(4px);
        }

        .scrollable-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
        }

        .column-workstation { width: 15%; }
        .column-code { width: 40%; }
        .shift-down { margin-top: 20px; transition: margin-top 0.5s ease-in-out; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.0.3/html5-qrcode.min.js"></script>
</head>
<body>
    <!-- Các nút chức năng -->
    <div class="field is-grouped">
        <p class="control">
            <button class="button is-info" onclick="ChangeName()">名前-NAME</button>
        </p>
        <p class="control">
            <button class="button is-success" onclick="ChangeWS()">工程-WORK</button>
        </p>
        <p class="control">
            <button class="button is-warning" onclick="ChangeCode()">QR-Code</button>
        </p>
        
    </div>

    <!-- Các trường nhập dữ liệu -->
    <div id="input-fields">
        <input class="input is-normal input-name is-fullwidth" placeholder="Nameー名前" id="Name">
        <input class="input is-normal input-ws is-fullwidth" placeholder="Work stationー工程ー機械ー場所" id="WS">
        <input class="input is-rounded is-large input-code is-fullwidth" placeholder="Codeー図面コード" id="code" inputmode="latin" lang="en">
        <div id="optional-fields" style="display: none;">
            <input class="input is-normal is-large input-Number" placeholder="Number-数量" id="Number-code">
            <input class="input is-small input-NG" placeholder="不良数/不足数-Số hàng hỏng hoặc thiếu" id="NG-code">
        </div>
    </div>
    <button class="button is-info" onclick="toggleOptionalFields()">Thêm/Sửa Thông Tin Chi Tiết</button>

    <!-- Nút lưu dữ liệu -->
    <button class="button is-danger is-fullwidth" onclick="sendData()">Save-保存</button>

    <!-- Nút ẩn/hiện danh sách -->
    <button class="button is-link is-fullwidth" onclick="toggleDataList()">Ẩn/Hiện Danh Sách</button>

    <!-- Vùng hiển thị Camera QR Code -->
    <div style="width: 800px; margin: 0 auto;" id="reader"></div>
    <div id="error-message" style="color: red; text-align: center; margin-top: 10px;"></div>

    <!-- Bảng hiển thị dữ liệu đã nhập -->
    <div class="container is-fluid" id="data-container" style="display: none;">
       
        <h2 class="title">データ一覧 - Danh sách dữ liệu đã nhập</h2>
        <div class="scrollable-list">
            <table class="table is-fullwidth is-bordered">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th class="column-workstation">Workstation</th>
                        <th class="column-code">Code</th>
                        <th>Number</th>
                        <th>NG</th>
                    </tr>
                </thead>
                <tbody id="data-table-body"></tbody>
            </table>
        </div>
    </div>

    <script>
        function openPage() {
            window.open("https://ohshima-kousakusho.github.io/tana1/", "_blank");
        }

        function ChangeName() {
            document.querySelector('.input-name').value = '';
            document.getElementById("Name").focus();
        }

        function ChangeWS() {
            document.querySelector('.input-ws').value = '';
            document.getElementById("WS").focus();
        }

        function ChangeCode() {
            document.querySelector('.input-code').value = '';
            document.getElementById("code").focus();
        }

        function IsEmpty() {
            if (document.querySelector('.input-ws').value === "") {
                alert("工程を入力してください-Hãy nhập nội dung công việc của bạn");
                return false;
            }
            return true;
        }

        function toggleDataList() {
            const dataContainer = document.getElementById('data-container');
            dataContainer.style.display = dataContainer.style.display === 'none' ? 'block' : 'none';
        }

        function toggleOptionalFields() {
            const optionalFields = document.getElementById('optional-fields');
            optionalFields.style.display = optionalFields.style.display === 'none' ? 'block' : 'none';
        }

        function sendData() {
            if (!IsEmpty()) return;

            if (document.querySelector('.input-code').value === "") {
                alert("QRコードを入力してください-Hãy nhập mã hàng");
                return false;
            }

            const name = document.querySelector('.input-name').value;
            const ws = document.querySelector('.input-ws').value;
            const code = document.querySelector('.input-code').value;
            const number = document.querySelector('.input-Number').value;
            const ng = document.querySelector('.input-NG').value;

            addDataToTable(name, ws, code, number, ng);

            const API_URL = "https://script.google.com/macros/s/AKfycby5LqJpRG0FT_to9d1Qql932xV0Zre5P60ntrX1FGhsdtAC5Nrzcc4jeYPI2yaKZik/exec";
            const options = {
                method: 'POST',
                contentType: 'application/json',
                body: JSON.stringify({ name, ws, Number: number, NG: ng, class: code + "$" })
            };

            fetch(API_URL, options)
                .then(response => response.json())
                .then(data => console.log(data))
                .catch(err => console.error("Lỗi khi gửi dữ liệu:", err));

            document.querySelector('.input-code').value = '';
            document.querySelector('.input-Number').value = '';
            document.querySelector('.input-NG').value = '';
            document.getElementById("code").focus();

            play();
        }

        function addDataToTable(name, ws, code, number, ng) {
            const tableBody = document.getElementById('data-table-body');
            const newRow = document.createElement('tr');

            newRow.innerHTML = `
                <td>${name}</td>
                <td>${ws}</td>
                <td>${code}</td>
                <td>${number}</td>
                <td>${ng}</td>
            `;

            tableBody.insertBefore(newRow, tableBody.firstChild);
        }

        function play() { 
            var audio = new Audio('https://media.geeksforgeeks.org/wp-content/uploads/20190531135120/beep.mp3'); 
            audio.play(); 
        }
    </script>
</body>
</html>
